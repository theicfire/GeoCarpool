<!DOCTYPE html>
<html>
  <head>
    <meta name="viewport" content="initial-scale=1.0, user-scalable=no" />
    <style type="text/css">
      html { height: 100% }
      body { height: 100%; margin: 0; padding: 0 }
      #map-canvas { height: 100% }
    </style>
    <script src="//code.jquery.com/jquery-1.10.2.min.js"/>
    <script type="text/javascript">
      $.noConflict();
    </script>
    <script type="text/javascript"
      src="https://maps.googleapis.com/maps/api/js?key=AIzaSyAU3clbI9RBtk01fB6Ka0pr0Adnk50yNnE&sensor=false">
    </script>
    <script type="text/javascript">
      jQuery( document ).ready(function( $ ) {
        var map;
        var markers = [];
        function initialize() {
            var myLatlng = new google.maps.LatLng(42.6461238367, -83);
            var mapOptions = {
              zoom: 8,
              center: myLatlng
            }
            map = new google.maps.Map(document.getElementById('map-canvas'), mapOptions);
        }

        function clearMarkers() {
          for (var i = 0; i < markers.length; i++ ) {
            markers[i].setMap(null);
          }
          markers.length = 0;
        }

        function drawMarker(lat, lng, title) {
              var latlng = new google.maps.LatLng(lat, lng);
              var marker = new google.maps.Marker({
                  position: latlng,
                  map: map,
                  title: title
              });
              markers.push(marker);

        }
        google.maps.event.addDomListener(window, 'load', initialize);
        $.getJSON("best-rides.json", function(json) {
            best_trips = json[0];
            all_trips = json[1];
            console.log(json);
            // console.log(best_trips); // this will show the info it in firebug console
            $.each(all_trips, function (id, trip) {
              var latlng = new google.maps.LatLng(trip.start_lat, trip.start_lon);
              // var myLatlng = new google.maps.LatLng(trip.start_lat, trip.start_lon);
              drawMarker(trip.start_lat, trip.start_lon, id);

              $('#pick-trip')
               .append($("<option></option>")
               .attr("value",id)
               .text(id)); 
            });
            $('#pick-trip').change(function () {
              var carpoolee_id = $(this).find('option:selected').text();
              console.log('id', carpoolee_id);
              var carpooler = all_trips[carpoolee_id];
              var carpoolee = best_trips[carpoolee_id];

              // console.log('clicked', $(this).find('option:selected').text());
              // console.log('best', json[$(this).find('option:selected').text()]);
              clearMarkers();

              console.log(carpoolee);
              console.log(carpooler);
              // show just the right markers
              if (carpoolee) {
                drawMarker(carpoolee.start_lat, carpoolee.start_lon, carpoolee.id);
                drawMarker(carpoolee.end_lat, carpoolee.end_lon, carpoolee.id);
              } else {
                console.log('cannot find someone to pick up');
              }
              drawMarker(carpooler.start_lat, carpooler.start_lon, carpooler.id);
              drawMarker(carpooler.end_lat, carpooler.end_lon, carpooler.id);



            });

        });


      });
    </script>
  </head>
  <body>
    hello
    <select id='pick-trip'>
    </select>
    <div id="map-canvas"/>
  </body>
</html>